# ğŸ“˜ GuÃ­a Maestra de Desarrollo: Proyecto Huertify

**Stack TecnolÃ³gico:** NestJS (Backend) | Nuxt 3 (Frontend) | Prisma (ORM) | PostgreSQL

---

## 1. ğŸ¤– Protocolo para el Asistente IA (Antigravity/IDX)

**Rol:** ActÃºa como un Arquitecto de Software Senior.
**Mandato:** Antes de generar cÃ³digo, verifica que la soluciÃ³n cumpla con:

*   ğŸ”’ **Encapsulamiento:** Cada dominio de negocio debe estar aislado.
*   ğŸ“ **Tipado Estricto:** **Prohibido** el uso de `any`. Todo debe tener interfaces o tipos.
*   ğŸ›¡ï¸ **ValidaciÃ³n:** No se procesan datos que no pasen por un DTO o esquema de validaciÃ³n.
*   ğŸ” **AuditorÃ­a de Seguridad:** Antes de proponer cambios, analiza si existe algÃºn riesgo de seguridad (ej. puertos expuestos, credenciales hardcoded, falta de cifrado) y **AVISA** al usuario inmediatamente antes de proceder.
*   ğŸ“ **DocumentaciÃ³n:** Todo archivo nuevo debe llevar el encabezado estÃ¡ndar.

---

## 2. ğŸ”™ Backend Architecture (NestJS)

El backend sigue un patrÃ³n de **Monolito Modular** preparado para microservicios.

### ğŸ”¹ Estructura de Capas por Dominio
Cada carpeta en `src/modules/[dominio]` debe seguir este orden:

| Capa | Responsabilidad | Regla de Oro |
| :--- | :--- | :--- |
| **Controller** | Puerta de entrada HTTP. | Solo llama al Service. No tiene lÃ³gica. |
| **Service** | Orquestador de lÃ³gica de negocio. | Ãšnico lugar para `if/else` de negocio. |
| **Repository** | Acceso a datos (Prisma). | Abstrae las queries complejas de la base de datos. |
| **DTO** | Contratos de entrada/salida. | Usa `class-validator` para sanear la entrada. |

### ğŸ”¹ Persistencia con Prisma
*   **Single Source of Truth:** El archivo `schema.prisma` define la realidad.
*   **Migrations:** Todo cambio se hace vÃ­a `npx prisma migrate dev`.
*   **Models:** Nunca devuelvas un modelo de Prisma directamente al front; mapealo a un DTO de salida.
*   **DocumentaciÃ³n Viva:** MantÃ©n siempre actualizado **`backend/01-DATABASE_SCHEMA.md`**. Si modificas `schema.prisma` (tablas, Ã­ndices, campos), **DEBES** actualizar este documento.
*   **Consulta Req:** Antes de escribir queries complejas, consulta `01-DATABASE_SCHEMA.md` para entender relaciones e Ã­ndices existentes.

---

## 3. ğŸ¨ Frontend Architecture (Nuxt 3)

Enfoque en **Universal Rendering (SSR)** y diseÃ±o escalable.

### ğŸ”¹ Componentes (Atomic Design)
Para evitar el desorden en la carpeta `components/`, organizamos por nivel de complejidad:

*   âš›ï¸ **Atoms:** Elementos puros (botones, inputs, iconos). No tienen lÃ³gica de negocio.
*   ğŸ§¬ **Molecules:** UniÃ³n de Ã¡tomos (un campo de bÃºsqueda con botÃ³n, una tarjeta de producto).
*   ğŸ¦  **Organisms:** Secciones de la pÃ¡gina que manejan datos (un formulario de registro, un sidebar).

### ğŸ”¹ Estado y LÃ³gica
*   **Composables:** Toda la lÃ³gica reactiva vive en `composables/` (ej. `useStock.ts`). **Prohibido** usar Mixins.
*   **InternacionalizaciÃ³n:** Uso obligatorio de `@nuxtjs/i18n`. El texto hardcoded estÃ¡ prohibido: usa siempre `$t('key')`.

---

## 4. ğŸ“ EstÃ¡ndares de CÃ³digo y Nomenclatura

### ğŸ”¹ Convenciones de Nombres
*   **Clases y Componentes:** `PascalCase` (ej. `ProductService.ts`, `UserCard.vue`).
*   **Variables y Funciones:** `camelCase` (ej. `getInventory()`).
*   **Tablas de BD:** `snake_case` (ej. `cooperative_members`).
*   **Archivos de LÃ³gica:** `kebab-case` (ej. `auth-middleware.ts`).

### ğŸ”¹ EstÃ¡ndar de Encabezado de Archivo
Todo archivo debe iniciar con el siguiente bloque, explicando funcionalidad y diseÃ±o:

```typescript
/*
 * File: [Nombre del archivo]
 * Purpose: [DescripciÃ³n funcional detallada]
 * Design: [ExplicaciÃ³n de decisiones de diseÃ±o UI/UX o Arquitectura]
 * Dependencies: [Lista de dependencias crÃ­ticas]
 * Domain: [Dominio: Ventas, LogÃ­stica, etc]
 */
```

### ğŸ”¹ Comentarios en CÃ³digo
*   **Explicativos:** Cada bloque lÃ³gico importante debe tener un comentario previo explicando QUÃ‰ hace y POR QUÃ‰, 
*   **No Obvios:** Evita comentarios redundantes ("suma 1 a i"), enfÃ³cate en la intenciÃ³n de negocio.

---

## 5. âœ… Calidad, Seguridad y Escalabilidad

*   **JSDoc:** Documenta todos los mÃ©todos pÃºblicos de los servicios explicando los parÃ¡metros y el retorno.
*   ğŸš¨ **Alertas de Seguridad:** Es **OBLIGATORIO** advertir al usuario sobre cualquier agujero de seguridad potencial que se detecte en la configuraciÃ³n (Docker, variables de entorno, permisos de archivos de persistencia, etc.).
*   **Error Handling:** El backend debe devolver cÃ³digos de error semÃ¡nticos (ej. `ERR_STOCK_INSUFFICIENT`) y el frontend debe capturarlos mediante un interceptor global.
*   ğŸ–¼ï¸ **EstÃ¡ndar de ImÃ¡genes (OBLIGATORIO):**
    *   **Formato:** Siempre usar **WebP** para ahorro de ancho de banda.
    *   **Dimensiones:** MÃ¡ximo **1000px** (ancho o alto).
    *   **Calidad:** 80% (Sharp).
    *   **Frontend:** Aplicar siempre `loading="lazy"` y anteponer `apiBase` para rutas relativas (`src.startsWith('http') ? src : apiBase + src`).
*   **Design Tokens:** Colores, espaciados y tipografÃ­as deben leerse de `tailwind.config.ts` o un archivo de tokens centralizado para asegurar consistencia visual.
*   **Testing:**
    *   ğŸ§ª **Backend:** Unit tests for cada Service.
    *   ğŸ–¼ï¸ **Frontend:** Tests de componentes para los Organisms.

---

## 7. ğŸ“š Contexto del Proyecto y Especificaciones
Es **OBLIGATORIO** consultar estos archivos antes de proponer cambios estructurales para asegurar la alineaciÃ³n con la visiÃ³n original:

- ğŸ¨ **DiseÃ±o:** [00-DESIGN_SPEC.md](file:///home/dan/huertify/frontend/00-DESIGN_SPEC.md) - EstÃ©tica y UX.
- ğŸ—„ï¸ **Base de Datos:** [01-DATABASE_SCHEMA.md](file:///home/dan/huertify/backend/01-DATABASE_SCHEMA.md) - Relaciones y RLS.
- ğŸ›£ï¸ **Roadmap:** [02-ROADMAP_AND_FLOWS.md](file:///home/dan/huertify/backend/02-ROADMAP_AND_FLOWS.md) - Flujos lÃ³gicos.
- ğŸ“‘ **Especificaciones:** [03-MASTER_SPECIFICATIONS.md](file:///home/dan/huertify/backend/03-MASTER_SPECIFICATIONS.md) - El documento maestro.

---

## 6. ğŸ”® Futuras Mejoras
*   **TODO List:** Las propuestas de mejoras tÃ©cnicas (refactors complejos, nuevas features no prioritarias como WebSockets) deben registrarse en **`TODO_Huertify.md`** en la raÃ­z del proyecto.

