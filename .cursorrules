# ğŸ“˜ GuÃ­a Maestra de Desarrollo: Proyecto Huertify

**Stack TecnolÃ³gico:** NestJS (Backend) | Nuxt 3 (Frontend) | Prisma (ORM) | PostgreSQL

---

## 1. ğŸ¤– Protocolo para el Asistente IA (Antigravity/IDX)

**Rol:** ActÃºa como un Arquitecto de Software Senior.
**Mandato:** Antes de generar cÃ³digo, verifica que la soluciÃ³n cumpla con:

*   ğŸ”’ **Encapsulamiento:** Cada dominio de negocio debe estar aislado.
*   ğŸ“ **Tipado Estricto:** **Prohibido** el uso de `any`. Todo debe tener interfaces o tipos.
*   ğŸ›¡ï¸ **ValidaciÃ³n:** No se procesan datos que no pasen por un DTO o esquema de validaciÃ³n.
*   ğŸ“ **DocumentaciÃ³n:** Todo archivo nuevo debe llevar el encabezado estÃ¡ndar.

---

## 2. ğŸ”™ Backend Architecture (NestJS)

El backend sigue un patrÃ³n de **Monolito Modular** preparado para microservicios.

### ğŸ”¹ Estructura de Capas por Dominio
Cada carpeta en `src/modules/[dominio]` debe seguir este orden:

| Capa | Responsabilidad | Regla de Oro |
| :--- | :--- | :--- |
| **Controller** | Puerta de entrada HTTP. | Solo llama al Service. No tiene lÃ³gica. |
| **Service** | Orquestador de lÃ³gica de negocio. | Ãšnico lugar para `if/else` de negocio. |
| **Repository** | Acceso a datos (Prisma). | Abstrae las queries complejas de la base de datos. |
| **DTO** | Contratos de entrada/salida. | Usa `class-validator` para sanear la entrada. |

### ğŸ”¹ Persistencia con Prisma
*   **Single Source of Truth:** El archivo `schema.prisma` define la realidad.
*   **Migrations:** Todo cambio se hace vÃ­a `npx prisma migrate dev`.
*   **Models:** Nunca devuelvas un modelo de Prisma directamente al front; mapealo a un DTO de salida.
*   **DocumentaciÃ³n Viva:** MantÃ©n siempre actualizado **`backend/01-DATABASE_SCHEMA.md`**. Si modificas `schema.prisma` (tablas, Ã­ndices, campos), **DEBES** actualizar este documento.
*   **Consulta Req:** Antes de escribir queries complejas, consulta `01-DATABASE_SCHEMA.md` para entender relaciones e Ã­ndices existentes.

---

## 3. ğŸ¨ Frontend Architecture (Nuxt 3)

Enfoque en **Universal Rendering (SSR)** y diseÃ±o escalable.

### ğŸ”¹ Componentes (Atomic Design)
Para evitar el desorden en la carpeta `components/`, organizamos por nivel de complejidad:

*   âš›ï¸ **Atoms:** Elementos puros (botones, inputs, iconos). No tienen lÃ³gica de negocio.
*   ğŸ§¬ **Molecules:** UniÃ³n de Ã¡tomos (un campo de bÃºsqueda con botÃ³n, una tarjeta de producto).
*   ğŸ¦  **Organisms:** Secciones de la pÃ¡gina que manejan datos (un formulario de registro, un sidebar).

### ğŸ”¹ Estado y LÃ³gica
*   **Composables:** Toda la lÃ³gica reactiva vive en `composables/` (ej. `useStock.ts`). **Prohibido** usar Mixins.
*   **InternacionalizaciÃ³n:** Uso obligatorio de `@nuxtjs/i18n`. El texto hardcoded estÃ¡ prohibido: usa siempre `$t('key')`.

---

## 4. ğŸ“ EstÃ¡ndares de CÃ³digo y Nomenclatura

### ğŸ”¹ Convenciones de Nombres
*   **Clases y Componentes:** `PascalCase` (ej. `ProductService.ts`, `UserCard.vue`).
*   **Variables y Funciones:** `camelCase` (ej. `getInventory()`).
*   **Tablas de BD:** `snake_case` (ej. `cooperative_members`).
*   **Archivos de LÃ³gica:** `kebab-case` (ej. `auth-middleware.ts`).

### ğŸ”¹ EstÃ¡ndar de Encabezado de Archivo
Todo archivo debe iniciar con el siguiente bloque:

```typescript
/*
 * File: [Nombre del archivo]
 * Purpose: [DescripciÃ³n breve de quÃ© hace]
 * Dependencies: [Lista de dependencias crÃ­ticas o servicios que usa]
 * Domain: [Nombre del dominio: ej. Ventas, Usuarios, LogÃ­stica]
 */
```

---

## 5. âœ… Calidad, Seguridad y Escalabilidad

*   **JSDoc:** Documenta todos los mÃ©todos pÃºblicos de los servicios explicando los parÃ¡metros y el retorno.
*   **Error Handling:** El backend debe devolver cÃ³digos de error semÃ¡nticos (ej. `ERR_STOCK_INSUFFICIENT`) y el frontend debe capturarlos mediante un interceptor global.
*   **Design Tokens:** Colores, espaciados y tipografÃ­as deben leerse de `tailwind.config.ts` o un archivo de tokens centralizado para asegurar consistencia visual.
*   **Testing:**
    *   ğŸ§ª **Backend:** Unit tests para cada Service.
    *   ğŸ–¼ï¸ **Frontend:** Tests de componentes para los Organisms.
